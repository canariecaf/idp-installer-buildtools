<VirtualHost *:443>
#
# automatically provisioned file from CDS github repo
#

  ServerName              ds.example.com:443
  ServerAdmin             webmaster@example.com
  DocumentRoot            /var/www/vhosts/ds.example.com
  SSLEngine on
  SSLCertificateFile      /etc/ssl/certs/ds.example.com.crt
  SSLCertificateKeyFile   /etc/ssl/private/ds.example.com.key
  #
  # das Chain-File ist bei vielen CAs nötig damit der Webserver die
  # ganze Zertifikatskette ausliefern kann. Nur damit kann der Browser des
  # Nutzers das Server-Zertifikat dann auch gegen eine ihm bekannte
  # Root-CA verifizieren.
  #
  #SSLCertificateChainFile /etc/ssl/certs/ca-chain.crt
  #
  # unsichere Verschlüsselung abschalten/verhindern (Debian)
  #
  SSLProtocol All -SSLv2 -SSLv3
  SSLHonorCipherOrder On
  SSLCipherSuite 'ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:RSA+AESGCM:RSA+AES:ECDH+3DES:DH+3DES:RSA+3DES:!aNULL:!eNULL:!LOW:!RC4:!MD5:!EXP:!PSK:!DSS:!SEED:!ECDSA:!CAMELLIA'
  
  <Location /shibboleth-sp>
    Allow from all
  </Location>
  Alias /shibboleth-sp/main.css /usr/share/shibboleth/main.css
  Alias /shibboleth-sp/logo.jpg /usr/share/shibboleth/logo.jpg
 
  <Location /secure-all>
    AuthType shibboleth
    ShibRequireSession On
    require valid-user
  </Location>
 
  <Location /secure-memberonly>
    AuthType shibboleth
    ShibRequireSession On
    # require affiliation ~ ^member@
  </Location>

 <Location /cgi-bin/test.py>
    AuthType shibboleth
    ShibRequireSession On
    require valid-user
    SSLUserName mail
  </Location>
  ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
  ScriptAlias /plain/cgi-bin/ /usr/lib/cgi-bin/
  <Directory "/var/www/vhosts/test-sp">
    AllowOverride None
    Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
    Order allow,deny
    Allow from all
  </Directory>
  <Directory "/usr/lib/cgi-bin">
    AllowOverride None
    Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
    Order allow,deny
    Allow from all
  </Directory>


#
# Discovery Service mapping that enables the CAF.ds to function as advertised
#

<Directory /var/www/vhosts/ds.example.com/DS>
    Options Indexes MultiViews
    AllowOverride None
    Order allow,deny
    Allow from all

    <FilesMatch ".+\.ds$">
SetHandler application/x-httpd-php

      AcceptPathInfo On
    </FilesMatch>

</Directory>


 
  ## bei Apache 2.4 bzw. um bei Shibboleth SP >= 2.5.2 aufwärtskompatibel zu sein
  ## (vgl. https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPApacheConfig)
  #<Location /secure-memberonly>
  #  AuthType shibboleth
  #  ShibCompatWith24 On
  #  ShibRequestSetting requireSession 1
  #  require shib-attr affiliation ~ ^member@
  #</Location>
 
  # optional (Metadata-Access at entityID-URL)
  Redirect seeother /shibboleth https://ds.example.com/Shibboleth.sso/Metadata
 
</VirtualHost>